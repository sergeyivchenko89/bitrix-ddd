# Промт для автоматизации сборки для локальной разработки Bitrix

## Постановка задачи
Необходимо реализовать сложный скрипт для того, чтобы развернуть локальное окружение для bitrix-разработки. Давайте представим, что я - лид-команды разработки, а ИИ - разработчик уровня Middle. Необходимо собрать в целостный скрипт установку и настройку локального окружения на основе Docker.

1. ### Подготовка. Входные данные

    1.1 Для базы данных Будем использовать официальный docker-образ mariadb:10.6

    1.2 Для fpm будем использовать оригинальный образ php:8.2-fpm
    
    1.3 Для балансировщика будем использовать docker-образ nginx:latest
    
    1.4 Успешные системные сообщения оформляем в жирный текст зеленого цвета. Использовать функцию printf
    
    1.5 Системные сообщения с ошибками оформляем в жирный шрифт красного цвета. Использовать функцию printf

    1.6 Если в корне еще нет директории docker, тогда создай ее. Там мы будем хранить файлы конфигурации типа php.ini или nginx.conf

2. ### Подготовка. Проверка существующего проекта

    2.1. Проверим наличие директорий bitrix и upload в корневой директории.
    
    2.2. Если директории существуют, тогда считаем, что работаем уже с развернутым проектом Bitrix и переходим к пункту 3.1

    2.3. Проверяем существование архива small_business_encode.tar.gz. Переходим в пункт 1.5

    2.4. Скачиваем файл https://www.1c-bitrix.ru/download/small_business_encode.tar.gz командой curl с указанием User_Agent и учетом того, что оригинальная ссылка может иметь редирект.

    2.5. Выполняем распаковку архива в существующую директорию с помощью утилиты tar.

    2.6. Удаляем архив

3. ### Подготовка. Удаление существующих контейнеров

    3.1 Необходимо выполнить проверку на существование контейнера. Если контейнер существует, то остановить его и удалить. Название контейнера будет определено позднее.

    3.2 Выполняем действия пункта 3.1 для контейнера  bitrix_demo_db

    3.3 Выполняем действия пункта 3.1 для контейнера  bitrix_demo_fpm

    3.4 Выполняем действия пункта 3.1 для контейнера bitrix_demo_balancer

4. ### Установка. Docker-compose 

    Создадим файл docker-compose.yaml. Не указывай версию, потому что при сборке возникает ошибка

5. ### Установка. Сеть

    Создай общую сеть bitrix_demo_network для проекта

6. ### Установка. База данных

    6.1 Создай дополнительную директорию db_data в корне для хранения данных БД
    
    6.2 Создай новый сервис для базы в docker-compose.yaml. Назови его db. Установи container_name для него: bitrix_demo_db
    
    6.3 Смонтируй  директорию db_data в volumes контейнера db

7. ### Установка. FPM

    7.1 Добавь в docker-compose сервис php-fpm на основе образа, который мы обсуждали ранее. Имя контейнера - fpm, его container_name равен bitrix_demo_fpm

    7.2 Если в директории docker еще нет поддиректории php, тогда создай ее. Внутри нее бы будем хранить настройки php (www.conf, php.ini и так далее)

    7.3 Создай внутри нее все необходимые конфигурации с учетом того, что они должны работать с bitrix и смонтируй в volumes

    7.4 Запуск контейнера fpm должен производиться после контейнера db

8. ### Установка. Балансировщик

    8.1 Добавить в docker-compose сервис nginx на основе того образа, который обсуждали ранее. Назвать его blancer, его container_name равен bitrix_demo_nginx

    8.2 создать директорию docker/nginx. В ней будем хранить все необходимые конфигурации для балансировщика

    8.3 Создать в docker/nginx необходимые файлы для работы с проектом bitrix.

    8.4 Запуск контейнера должен производиться после контейнера fpm

9. ### Конфигурация. Битрикс

    9.1 Проверяем наличие файла install.config в корне. Если файла нет, тогда переходим к пункту 100


100. ### Запуск docker-compose

    Выполни запуск ранее созданных контейнеров
